function [u_sol,u_exact] = task52d(N)

addpath ..\Grids
addpath ..\Oppgave1

[p,tri,edge] = getPlate(N);
f= @(x,y,E,v) E/(1-v^2) * [-2*y.^2 + x.^2*(v-1) - 2*x.*y*(v+1) + 3 - v;
                          -2*x.^2 + y.^2*(v-1) - 2*x.*y*(v+1) + 3 - v];
Ak =  @(E,v,p1,p2,p3)reshape([(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p2(1).*p3(1).*-2.0-p2(2).*p3(2).*2.0-v.*p2(1).^2-v.*p3(1).^2+p2(1).^2+p3(1).^2+p2(2).^2+p3(2).^2+v.*p2(1).*p3(1).*2.0).*(-1.0./2.0))./(v.^2-1.0),(E.*(p2(1)-p3(1)).*(p2(2)-p3(2)).*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(1)-p1(1).*p3(1)-p2(1).*p3(1)+p1(2).*p2(2)-p1(2).*p3(2)-p2(2).*p3(2)-v.*p3(1).^2+p3(1).^2+p3(2).^2-v.*p1(1).*p2(1)+v.*p1(1).*p3(1)+v.*p2(1).*p3(1)).*(1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p2(1).*p1(2)-p3(1).*p1(2)-p2(1).*p3(2)+p3(1).*p3(2)+v.*p1(1).*p2(2)-v.*p2(1).*p1(2)-v.*p1(1).*p3(2)+v.*p3(1).*p1(2)+v.*p2(1).*p3(2)-v.*p3(1).*p2(2)).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(1)-p1(1).*p3(1)+p2(1).*p3(1)+p1(2).*p2(2)-p1(2).*p3(2)+p2(2).*p3(2)+v.*p2(1).^2-p2(1).^2-p2(2).^2-v.*p1(1).*p2(1)+v.*p1(1).*p3(1)-v.*p2(1).*p3(1)).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p2(1).*p1(2)-p2(1).*p2(2)-p3(1).*p1(2)+p3(1).*p2(2)+v.*p1(1).*p2(2)-v.*p2(1).*p1(2)-v.*p1(1).*p3(2)+v.*p3(1).*p1(2)+v.*p2(1).*p3(2)-v.*p3(1).*p2(2)).*(1.0./2.0))./(v.^2-1.0),(E.*(p2(1)-p3(1)).*(p2(2)-p3(2)).*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p2(1).*p3(1).*-2.0-p2(2).*p3(2).*2.0-v.*p2(2).^2-v.*p3(2).^2+p2(1).^2+p3(1).^2+p2(2).^2+p3(2).^2+v.*p2(2).*p3(2).*2.0).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(2)-p1(1).*p3(2)-p3(1).*p2(2)+p3(1).*p3(2)-v.*p1(1).*p2(2)+v.*p2(1).*p1(2)+v.*p1(1).*p3(2)-v.*p3(1).*p1(2)-v.*p2(1).*p3(2)+v.*p3(1).*p2(2)).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(1)-p1(1).*p3(1)-p2(1).*p3(1)+p1(2).*p2(2)-p1(2).*p3(2)-p2(2).*p3(2)-v.*p3(2).^2+p3(1).^2+p3(2).^2-v.*p1(2).*p2(2)+v.*p1(2).*p3(2)+v.*p2(2).*p3(2)).*(1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(2)-p1(1).*p3(2)-p2(1).*p2(2)+p2(1).*p3(2)-v.*p1(1).*p2(2)+v.*p2(1).*p1(2)+v.*p1(1).*p3(2)-v.*p3(1).*p1(2)-v.*p2(1).*p3(2)+v.*p3(1).*p2(2)).*(1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(1)-p1(1).*p3(1)+p2(1).*p3(1)+p1(2).*p2(2)-p1(2).*p3(2)+p2(2).*p3(2)+v.*p2(2).^2-p2(1).^2-p2(2).^2-v.*p1(2).*p2(2)+v.*p1(2).*p3(2)-v.*p2(2).*p3(2)).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(1)-p1(1).*p3(1)-p2(1).*p3(1)+p1(2).*p2(2)-p1(2).*p3(2)-p2(2).*p3(2)-v.*p3(1).^2+p3(1).^2+p3(2).^2-v.*p1(1).*p2(1)+v.*p1(1).*p3(1)+v.*p2(1).*p3(1)).*(1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(2)-p1(1).*p3(2)-p3(1).*p2(2)+p3(1).*p3(2)-v.*p1(1).*p2(2)+v.*p2(1).*p1(2)+v.*p1(1).*p3(2)-v.*p3(1).*p1(2)-v.*p2(1).*p3(2)+v.*p3(1).*p2(2)).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p3(1).*-2.0-p1(2).*p3(2).*2.0-v.*p1(1).^2-v.*p3(1).^2+p1(1).^2+p3(1).^2+p1(2).^2+p3(2).^2+v.*p1(1).*p3(1).*2.0).*(-1.0./2.0))./(v.^2-1.0),(E.*(p1(1)-p3(1)).*(p1(2)-p3(2)).*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(1)+p1(1).*p3(1)-p2(1).*p3(1)+p1(2).*p2(2)+p1(2).*p3(2)-p2(2).*p3(2)+v.*p1(1).^2-p1(1).^2-p1(2).^2-v.*p1(1).*p2(1)-v.*p1(1).*p3(1)+v.*p2(1).*p3(1)).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p1(2)-p1(1).*p2(2)-p3(1).*p1(2)+p3(1).*p2(2)+v.*p1(1).*p2(2)-v.*p2(1).*p1(2)-v.*p1(1).*p3(2)+v.*p3(1).*p1(2)+v.*p2(1).*p3(2)-v.*p3(1).*p2(2)).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p2(1).*p1(2)-p3(1).*p1(2)-p2(1).*p3(2)+p3(1).*p3(2)+v.*p1(1).*p2(2)-v.*p2(1).*p1(2)-v.*p1(1).*p3(2)+v.*p3(1).*p1(2)+v.*p2(1).*p3(2)-v.*p3(1).*p2(2)).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(1)-p1(1).*p3(1)-p2(1).*p3(1)+p1(2).*p2(2)-p1(2).*p3(2)-p2(2).*p3(2)-v.*p3(2).^2+p3(1).^2+p3(2).^2-v.*p1(2).*p2(2)+v.*p1(2).*p3(2)+v.*p2(2).*p3(2)).*(1.0./2.0))./(v.^2-1.0),(E.*(p1(1)-p3(1)).*(p1(2)-p3(2)).*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p3(1).*-2.0-p1(2).*p3(2).*2.0-v.*p1(2).^2-v.*p3(2).^2+p1(1).^2+p3(1).^2+p1(2).^2+p3(2).^2+v.*p1(2).*p3(2).*2.0).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p1(2)-p2(1).*p1(2)-p1(1).*p3(2)+p2(1).*p3(2)-v.*p1(1).*p2(2)+v.*p2(1).*p1(2)+v.*p1(1).*p3(2)-v.*p3(1).*p1(2)-v.*p2(1).*p3(2)+v.*p3(1).*p2(2)).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(1)+p1(1).*p3(1)-p2(1).*p3(1)+p1(2).*p2(2)+p1(2).*p3(2)-p2(2).*p3(2)+v.*p1(2).^2-p1(1).^2-p1(2).^2-v.*p1(2).*p2(2)-v.*p1(2).*p3(2)+v.*p2(2).*p3(2)).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(1)-p1(1).*p3(1)+p2(1).*p3(1)+p1(2).*p2(2)-p1(2).*p3(2)+p2(2).*p3(2)+v.*p2(1).^2-p2(1).^2-p2(2).^2-v.*p1(1).*p2(1)+v.*p1(1).*p3(1)-v.*p2(1).*p3(1)).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(2)-p1(1).*p3(2)-p2(1).*p2(2)+p2(1).*p3(2)-v.*p1(1).*p2(2)+v.*p2(1).*p1(2)+v.*p1(1).*p3(2)-v.*p3(1).*p1(2)-v.*p2(1).*p3(2)+v.*p3(1).*p2(2)).*(1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(1)+p1(1).*p3(1)-p2(1).*p3(1)+p1(2).*p2(2)+p1(2).*p3(2)-p2(2).*p3(2)+v.*p1(1).^2-p1(1).^2-p1(2).^2-v.*p1(1).*p2(1)-v.*p1(1).*p3(1)+v.*p2(1).*p3(1)).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p1(2)-p2(1).*p1(2)-p1(1).*p3(2)+p2(1).*p3(2)-v.*p1(1).*p2(2)+v.*p2(1).*p1(2)+v.*p1(1).*p3(2)-v.*p3(1).*p1(2)-v.*p2(1).*p3(2)+v.*p3(1).*p2(2)).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(1).*-2.0-p1(2).*p2(2).*2.0-v.*p1(1).^2-v.*p2(1).^2+p1(1).^2+p2(1).^2+p1(2).^2+p2(2).^2+v.*p1(1).*p2(1).*2.0).*(-1.0./2.0))./(v.^2-1.0),(E.*(p1(1)-p2(1)).*(p1(2)-p2(2)).*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p2(1).*p1(2)-p2(1).*p2(2)-p3(1).*p1(2)+p3(1).*p2(2)+v.*p1(1).*p2(2)-v.*p2(1).*p1(2)-v.*p1(1).*p3(2)+v.*p3(1).*p1(2)+v.*p2(1).*p3(2)-v.*p3(1).*p2(2)).*(1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(1)-p1(1).*p3(1)+p2(1).*p3(1)+p1(2).*p2(2)-p1(2).*p3(2)+p2(2).*p3(2)+v.*p2(2).^2-p2(1).^2-p2(2).^2-v.*p1(2).*p2(2)+v.*p1(2).*p3(2)-v.*p2(2).*p3(2)).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p1(2)-p1(1).*p2(2)-p3(1).*p1(2)+p3(1).*p2(2)+v.*p1(1).*p2(2)-v.*p2(1).*p1(2)-v.*p1(1).*p3(2)+v.*p3(1).*p1(2)+v.*p2(1).*p3(2)-v.*p3(1).*p2(2)).*(-1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(1)+p1(1).*p3(1)-p2(1).*p3(1)+p1(2).*p2(2)+p1(2).*p3(2)-p2(2).*p3(2)+v.*p1(2).^2-p1(1).^2-p1(2).^2-v.*p1(2).*p2(2)-v.*p1(2).*p3(2)+v.*p2(2).*p3(2)).*(-1.0./2.0))./(v.^2-1.0),(E.*(p1(1)-p2(1)).*(p1(2)-p2(2)).*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(1.0./2.0))./(v.^2-1.0),(E.*1.0./(p1(1).*p2(2)-p2(1).*p1(2)-p1(1).*p3(2)+p3(1).*p1(2)+p2(1).*p3(2)-p3(1).*p2(2)).^3.*(p1(1).*p2(1).*-2.0-p1(2).*p2(2).*2.0-v.*p1(2).^2-v.*p2(2).^2+p1(1).^2+p2(1).^2+p1(2).^2+p2(2).^2+v.*p1(2).*p2(2).*2.0).*(-1.0./2.0))./(v.^2-1.0)],[6,6])

N = length(p)
A = spalloc(2*N,2*N,10*N);

for i = 1:length(p)
    p1 = p(tri(i,1),:)'; p2 = p(tri(i,2),:)'; p3 = p(tri(i,3),:)';
    A(
    
      
    
    
    
    
    
    
    
end
    